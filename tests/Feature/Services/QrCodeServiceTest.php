<?php

namespace Tests\Feature\Services;

use App\Facades\QrCode;
use App\Providers\TwoFAuthServiceProvider;
use App\Services\QrCodeService;
use Exception;
use PHPUnit\Framework\Attributes\CoversClass;
use PHPUnit\Framework\Attributes\DataProvider;
use PHPUnit\Framework\Attributes\Test;
use Tests\Classes\LocalFile;
use Tests\FeatureTestCase;
use Zxing\ChecksumException;
use Zxing\FormatException;
use Zxing\NotFoundException;
use Zxing\QrReader;

/**
 * QrCodeServiceTest test class
 */
#[CoversClass(QrCodeService::class)]
#[CoversClass(QrCode::class)]
#[CoversClass(TwoFAuthServiceProvider::class)]
class QrCodeServiceTest extends FeatureTestCase
{
    private const STRING_TO_ENCODE = 'x';

    // private const STRING_ENCODED = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGNsYXNzPSJxci1zdmcgcXJjb2RlIiB2aWV3Qm94PSIwIDAgMjUgMjUiIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaWRZTWlkIj4KPHBhdGggY2xhc3M9InFyLWRhdGEgbGlnaHQgcXJjb2RlIiBmaWxsPSIjZmZmIiBkPSJNMTEgMiBoMSB2MSBoLTFaIE0xMyAyIGgxIHYxIGgtMVogTTExIDMgaDEgdjEgaC0xWiBNMTIgMyBoMSB2MSBoLTFaIE0xMyAzIGgxIHYxIGgtMVogTTExIDQgaDEgdjEgaC0xWiBNMTMgNCBoMSB2MSBoLTFaIE0xNCA0IGgxIHYxIGgtMVogTTExIDUgaDEgdjEgaC0xWiBNMTIgNSBoMSB2MSBoLTFaIE0xMyA1IGgxIHYxIGgtMVogTTEyIDYgaDEgdjEgaC0xWiBNMTQgNyBoMSB2MSBoLTFaIE0xMSA5IGgxIHYxIGgtMVogTTEzIDkgaDEgdjEgaC0xWiBNMTQgOSBoMSB2MSBoLTFaIE0xMSAxMCBoMSB2MSBoLTFaIE0xMyAxMCBoMSB2MSBoLTFaIE0yIDExIGgxIHYxIGgtMVogTTYgMTEgaDEgdjEgaC0xWiBNMTEgMTEgaDEgdjEgaC0xWiBNMTIgMTEgaDEgdjEgaC0xWiBNMTQgMTEgaDEgdjEgaC0xWiBNMTYgMTEgaDEgdjEgaC0xWiBNMTggMTEgaDEgdjEgaC0xWiBNMjAgMTEgaDEgdjEgaC0xWiBNMjIgMTEgaDEgdjEgaC0xWiBNMiAxMiBoMSB2MSBoLTFaIE0zIDEyIGgxIHYxIGgtMVogTTQgMTIgaDEgdjEgaC0xWiBNNiAxMiBoMSB2MSBoLTFaIE05IDEyIGgxIHYxIGgtMVogTTExIDEyIGgxIHYxIGgtMVogTTE0IDEyIGgxIHYxIGgtMVogTTE4IDEyIGgxIHYxIGgtMVogTTE5IDEyIGgxIHYxIGgtMVogTTMgMTMgaDEgdjEgaC0xWiBNNCAxMyBoMSB2MSBoLTFaIE05IDEzIGgxIHYxIGgtMVogTTExIDEzIGgxIHYxIGgtMVogTTEyIDEzIGgxIHYxIGgtMVogTTE2IDEzIGgxIHYxIGgtMVogTTIwIDEzIGgxIHYxIGgtMVogTTIyIDEzIGgxIHYxIGgtMVogTTMgMTQgaDEgdjEgaC0xWiBNMTAgMTQgaDEgdjEgaC0xWiBNMTEgMTQgaDEgdjEgaC0xWiBNMTIgMTQgaDEgdjEgaC0xWiBNMTQgMTQgaDEgdjEgaC0xWiBNMTggMTQgaDEgdjEgaC0xWiBNMjEgMTQgaDEgdjEgaC0xWiBNMjIgMTQgaDEgdjEgaC0xWiBNMTMgMTUgaDEgdjEgaC0xWiBNMTQgMTUgaDEgdjEgaC0xWiBNMTUgMTUgaDEgdjEgaC0xWiBNMTcgMTUgaDEgdjEgaC0xWiBNMTggMTUgaDEgdjEgaC0xWiBNMTkgMTUgaDEgdjEgaC0xWiBNMjAgMTUgaDEgdjEgaC0xWiBNMjEgMTUgaDEgdjEgaC0xWiBNMTEgMTYgaDEgdjEgaC0xWiBNMTMgMTYgaDEgdjEgaC0xWiBNMTUgMTYgaDEgdjEgaC0xWiBNMTYgMTYgaDEgdjEgaC0xWiBNMTcgMTYgaDEgdjEgaC0xWiBNMjAgMTYgaDEgdjEgaC0xWiBNMTIgMTcgaDEgdjEgaC0xWiBNMTMgMTcgaDEgdjEgaC0xWiBNMTQgMTcgaDEgdjEgaC0xWiBNMTUgMTcgaDEgdjEgaC0xWiBNMTcgMTcgaDEgdjEgaC0xWiBNMTggMTcgaDEgdjEgaC0xWiBNMjEgMTcgaDEgdjEgaC0xWiBNMjIgMTcgaDEgdjEgaC0xWiBNMTEgMTggaDEgdjEgaC0xWiBNMTIgMTggaDEgdjEgaC0xWiBNMTMgMTggaDEgdjEgaC0xWiBNMTUgMTggaDEgdjEgaC0xWiBNMTcgMTggaDEgdjEgaC0xWiBNMTkgMTggaDEgdjEgaC0xWiBNMjEgMTggaDEgdjEgaC0xWiBNMTEgMTkgaDEgdjEgaC0xWiBNMTQgMTkgaDEgdjEgaC0xWiBNMTYgMTkgaDEgdjEgaC0xWiBNMTggMTkgaDEgdjEgaC0xWiBNMjAgMTkgaDEgdjEgaC0xWiBNMjIgMTkgaDEgdjEgaC0xWiBNMTQgMjAgaDEgdjEgaC0xWiBNMTggMjAgaDEgdjEgaC0xWiBNMTkgMjAgaDEgdjEgaC0xWiBNMjEgMjAgaDEgdjEgaC0xWiBNMTEgMjEgaDEgdjEgaC0xWiBNMTIgMjEgaDEgdjEgaC0xWiBNMTYgMjEgaDEgdjEgaC0xWiBNMjAgMjEgaDEgdjEgaC0xWiBNMjIgMjEgaDEgdjEgaC0xWiBNMTIgMjIgaDEgdjEgaC0xWiBNMTQgMjIgaDEgdjEgaC0xWiBNMTggMjIgaDEgdjEgaC0xWiBNMTkgMjIgaDEgdjEgaC0xWiIvPgo8cGF0aCBjbGFzcz0icXItZmluZGVyIGxpZ2h0IHFyY29kZSIgZmlsbD0iI2ZmZiIgZD0iTTMgMyBoMSB2MSBoLTFaIE00IDMgaDEgdjEgaC0xWiBNNSAzIGgxIHYxIGgtMVogTTYgMyBoMSB2MSBoLTFaIE03IDMgaDEgdjEgaC0xWiBNMTcgMyBoMSB2MSBoLTFaIE0xOCAzIGgxIHYxIGgtMVogTTE5IDMgaDEgdjEgaC0xWiBNMjAgMyBoMSB2MSBoLTFaIE0yMSAzIGgxIHYxIGgtMVogTTMgNCBoMSB2MSBoLTFaIE03IDQgaDEgdjEgaC0xWiBNMTcgNCBoMSB2MSBoLTFaIE0yMSA0IGgxIHYxIGgtMVogTTMgNSBoMSB2MSBoLTFaIE03IDUgaDEgdjEgaC0xWiBNMTcgNSBoMSB2MSBoLTFaIE0yMSA1IGgxIHYxIGgtMVogTTMgNiBoMSB2MSBoLTFaIE03IDYgaDEgdjEgaC0xWiBNMTcgNiBoMSB2MSBoLTFaIE0yMSA2IGgxIHYxIGgtMVogTTMgNyBoMSB2MSBoLTFaIE00IDcgaDEgdjEgaC0xWiBNNSA3IGgxIHYxIGgtMVogTTYgNyBoMSB2MSBoLTFaIE03IDcgaDEgdjEgaC0xWiBNMTcgNyBoMSB2MSBoLTFaIE0xOCA3IGgxIHYxIGgtMVogTTE5IDcgaDEgdjEgaC0xWiBNMjAgNyBoMSB2MSBoLTFaIE0yMSA3IGgxIHYxIGgtMVogTTMgMTcgaDEgdjEgaC0xWiBNNCAxNyBoMSB2MSBoLTFaIE01IDE3IGgxIHYxIGgtMVogTTYgMTcgaDEgdjEgaC0xWiBNNyAxNyBoMSB2MSBoLTFaIE0zIDE4IGgxIHYxIGgtMVogTTcgMTggaDEgdjEgaC0xWiBNMyAxOSBoMSB2MSBoLTFaIE03IDE5IGgxIHYxIGgtMVogTTMgMjAgaDEgdjEgaC0xWiBNNyAyMCBoMSB2MSBoLTFaIE0zIDIxIGgxIHYxIGgtMVogTTQgMjEgaDEgdjEgaC0xWiBNNSAyMSBoMSB2MSBoLTFaIE02IDIxIGgxIHYxIGgtMVogTTcgMjEgaDEgdjEgaC0xWiIvPgo8cGF0aCBjbGFzcz0icXItc2VwYXJhdG9yIGxpZ2h0IHFyY29kZSIgZmlsbD0iI2ZmZiIgZD0iTTkgMiBoMSB2MSBoLTFaIE0xNSAyIGgxIHYxIGgtMVogTTkgMyBoMSB2MSBoLTFaIE0xNSAzIGgxIHYxIGgtMVogTTkgNCBoMSB2MSBoLTFaIE0xNSA0IGgxIHYxIGgtMVogTTkgNSBoMSB2MSBoLTFaIE0xNSA1IGgxIHYxIGgtMVogTTkgNiBoMSB2MSBoLTFaIE0xNSA2IGgxIHYxIGgtMVogTTkgNyBoMSB2MSBoLTFaIE0xNSA3IGgxIHYxIGgtMVogTTkgOCBoMSB2MSBoLTFaIE0xNSA4IGgxIHYxIGgtMVogTTIgOSBoMSB2MSBoLTFaIE0zIDkgaDEgdjEgaC0xWiBNNCA5IGgxIHYxIGgtMVogTTUgOSBoMSB2MSBoLTFaIE02IDkgaDEgdjEgaC0xWiBNNyA5IGgxIHYxIGgtMVogTTggOSBoMSB2MSBoLTFaIE05IDkgaDEgdjEgaC0xWiBNMTUgOSBoMSB2MSBoLTFaIE0xNiA5IGgxIHYxIGgtMVogTTE3IDkgaDEgdjEgaC0xWiBNMTggOSBoMSB2MSBoLTFaIE0xOSA5IGgxIHYxIGgtMVogTTIwIDkgaDEgdjEgaC0xWiBNMjEgOSBoMSB2MSBoLTFaIE0yMiA5IGgxIHYxIGgtMVogTTIgMTUgaDEgdjEgaC0xWiBNMyAxNSBoMSB2MSBoLTFaIE00IDE1IGgxIHYxIGgtMVogTTUgMTUgaDEgdjEgaC0xWiBNNiAxNSBoMSB2MSBoLTFaIE03IDE1IGgxIHYxIGgtMVogTTggMTUgaDEgdjEgaC0xWiBNOSAxNSBoMSB2MSBoLTFaIE05IDE2IGgxIHYxIGgtMVogTTkgMTcgaDEgdjEgaC0xWiBNOSAxOCBoMSB2MSBoLTFaIE05IDE5IGgxIHYxIGgtMVogTTkgMjAgaDEgdjEgaC0xWiBNOSAyMSBoMSB2MSBoLTFaIE05IDIyIGgxIHYxIGgtMVoiLz4KPHBhdGggY2xhc3M9InFyLXRpbWluZyBsaWdodCBxcmNvZGUiIGZpbGw9IiNmZmYiIGQ9Ik0xMSA4IGgxIHYxIGgtMVogTTEzIDggaDEgdjEgaC0xWiBNOCAxMSBoMSB2MSBoLTFaIE04IDEzIGgxIHYxIGgtMVoiLz4KPHBhdGggY2xhc3M9InFyLWZvcm1hdCBsaWdodCBxcmNvZGUiIGZpbGw9IiNmZmYiIGQ9Ik0xMCAyIGgxIHYxIGgtMVogTTEwIDMgaDEgdjEgaC0xWiBNMTAgNSBoMSB2MSBoLTFaIE0xMCA2IGgxIHYxIGgtMVogTTEwIDcgaDEgdjEgaC0xWiBNNSAxMCBoMSB2MSBoLTFaIE0xNyAxMCBoMSB2MSBoLTFaIE0xOCAxMCBoMSB2MSBoLTFaIE0xOSAxMCBoMSB2MSBoLTFaIE0yMSAxMCBoMSB2MSBoLTFaIE0yMiAxMCBoMSB2MSBoLTFaIE0xMCAxOSBoMSB2MSBoLTFaIi8+CjxwYXRoIGNsYXNzPSJxci1xdWlldHpvbmUgbGlnaHQgcXJjb2RlIiBmaWxsPSIjZmZmIiBkPSJNMCAwIGgxIHYxIGgtMVogTTEgMCBoMSB2MSBoLTFaIE0yIDAgaDEgdjEgaC0xWiBNMyAwIGgxIHYxIGgtMVogTTQgMCBoMSB2MSBoLTFaIE01IDAgaDEgdjEgaC0xWiBNNiAwIGgxIHYxIGgtMVogTTcgMCBoMSB2MSBoLTFaIE04IDAgaDEgdjEgaC0xWiBNOSAwIGgxIHYxIGgtMVogTTEwIDAgaDEgdjEgaC0xWiBNMTEgMCBoMSB2MSBoLTFaIE0xMiAwIGgxIHYxIGgtMVogTTEzIDAgaDEgdjEgaC0xWiBNMTQgMCBoMSB2MSBoLTFaIE0xNSAwIGgxIHYxIGgtMVogTTE2IDAgaDEgdjEgaC0xWiBNMTcgMCBoMSB2MSBoLTFaIE0xOCAwIGgxIHYxIGgtMVogTTE5IDAgaDEgdjEgaC0xWiBNMjAgMCBoMSB2MSBoLTFaIE0yMSAwIGgxIHYxIGgtMVogTTIyIDAgaDEgdjEgaC0xWiBNMjMgMCBoMSB2MSBoLTFaIE0yNCAwIGgxIHYxIGgtMVogTTAgMSBoMSB2MSBoLTFaIE0xIDEgaDEgdjEgaC0xWiBNMiAxIGgxIHYxIGgtMVogTTMgMSBoMSB2MSBoLTFaIE00IDEgaDEgdjEgaC0xWiBNNSAxIGgxIHYxIGgtMVogTTYgMSBoMSB2MSBoLTFaIE03IDEgaDEgdjEgaC0xWiBNOCAxIGgxIHYxIGgtMVogTTkgMSBoMSB2MSBoLTFaIE0xMCAxIGgxIHYxIGgtMVogTTExIDEgaDEgdjEgaC0xWiBNMTIgMSBoMSB2MSBoLTFaIE0xMyAxIGgxIHYxIGgtMVogTTE0IDEgaDEgdjEgaC0xWiBNMTUgMSBoMSB2MSBoLTFaIE0xNiAxIGgxIHYxIGgtMVogTTE3IDEgaDEgdjEgaC0xWiBNMTggMSBoMSB2MSBoLTFaIE0xOSAxIGgxIHYxIGgtMVogTTIwIDEgaDEgdjEgaC0xWiBNMjEgMSBoMSB2MSBoLTFaIE0yMiAxIGgxIHYxIGgtMVogTTIzIDEgaDEgdjEgaC0xWiBNMjQgMSBoMSB2MSBoLTFaIE0wIDIgaDEgdjEgaC0xWiBNMSAyIGgxIHYxIGgtMVogTTIzIDIgaDEgdjEgaC0xWiBNMjQgMiBoMSB2MSBoLTFaIE0wIDMgaDEgdjEgaC0xWiBNMSAzIGgxIHYxIGgtMVogTTIzIDMgaDEgdjEgaC0xWiBNMjQgMyBoMSB2MSBoLTFaIE0wIDQgaDEgdjEgaC0xWiBNMSA0IGgxIHYxIGgtMVogTTIzIDQgaDEgdjEgaC0xWiBNMjQgNCBoMSB2MSBoLTFaIE0wIDUgaDEgdjEgaC0xWiBNMSA1IGgxIHYxIGgtMVogTTIzIDUgaDEgdjEgaC0xWiBNMjQgNSBoMSB2MSBoLTFaIE0wIDYgaDEgdjEgaC0xWiBNMSA2IGgxIHYxIGgtMVogTTIzIDYgaDEgdjEgaC0xWiBNMjQgNiBoMSB2MSBoLTFaIE0wIDcgaDEgdjEgaC0xWiBNMSA3IGgxIHYxIGgtMVogTTIzIDcgaDEgdjEgaC0xWiBNMjQgNyBoMSB2MSBoLTFaIE0wIDggaDEgdjEgaC0xWiBNMSA4IGgxIHYxIGgtMVogTTIzIDggaDEgdjEgaC0xWiBNMjQgOCBoMSB2MSBoLTFaIE0wIDkgaDEgdjEgaC0xWiBNMSA5IGgxIHYxIGgtMVogTTIzIDkgaDEgdjEgaC0xWiBNMjQgOSBoMSB2MSBoLTFaIE0wIDEwIGgxIHYxIGgtMVogTTEgMTAgaDEgdjEgaC0xWiBNMjMgMTAgaDEgdjEgaC0xWiBNMjQgMTAgaDEgdjEgaC0xWiBNMCAxMSBoMSB2MSBoLTFaIE0xIDExIGgxIHYxIGgtMVogTTIzIDExIGgxIHYxIGgtMVogTTI0IDExIGgxIHYxIGgtMVogTTAgMTIgaDEgdjEgaC0xWiBNMSAxMiBoMSB2MSBoLTFaIE0yMyAxMiBoMSB2MSBoLTFaIE0yNCAxMiBoMSB2MSBoLTFaIE0wIDEzIGgxIHYxIGgtMVogTTEgMTMgaDEgdjEgaC0xWiBNMjMgMTMgaDEgdjEgaC0xWiBNMjQgMTMgaDEgdjEgaC0xWiBNMCAxNCBoMSB2MSBoLTFaIE0xIDE0IGgxIHYxIGgtMVoKTTIzIDE0IGgxIHYxIGgtMVogTTI0IDE0IGgxIHYxIGgtMVogTTAgMTUgaDEgdjEgaC0xWiBNMSAxNSBoMSB2MSBoLTFaIE0yMyAxNSBoMSB2MSBoLTFaIE0yNCAxNSBoMSB2MSBoLTFaIE0wIDE2IGgxIHYxIGgtMVogTTEgMTYgaDEgdjEgaC0xWiBNMjMgMTYgaDEgdjEgaC0xWiBNMjQgMTYgaDEgdjEgaC0xWiBNMCAxNyBoMSB2MSBoLTFaIE0xIDE3IGgxIHYxIGgtMVogTTIzIDE3IGgxIHYxIGgtMVogTTI0IDE3IGgxIHYxIGgtMVogTTAgMTggaDEgdjEgaC0xWiBNMSAxOCBoMSB2MSBoLTFaIE0yMyAxOCBoMSB2MSBoLTFaIE0yNCAxOCBoMSB2MSBoLTFaIE0wIDE5IGgxIHYxIGgtMVogTTEgMTkgaDEgdjEgaC0xWiBNMjMgMTkgaDEgdjEgaC0xWiBNMjQgMTkgaDEgdjEgaC0xWiBNMCAyMCBoMSB2MSBoLTFaIE0xIDIwIGgxIHYxIGgtMVogTTIzIDIwIGgxIHYxIGgtMVogTTI0IDIwIGgxIHYxIGgtMVogTTAgMjEgaDEgdjEgaC0xWiBNMSAyMSBoMSB2MSBoLTFaIE0yMyAyMSBoMSB2MSBoLTFaIE0yNCAyMSBoMSB2MSBoLTFaIE0wIDIyIGgxIHYxIGgtMVogTTEgMjIgaDEgdjEgaC0xWiBNMjMgMjIgaDEgdjEgaC0xWiBNMjQgMjIgaDEgdjEgaC0xWiBNMCAyMyBoMSB2MSBoLTFaIE0xIDIzIGgxIHYxIGgtMVogTTIgMjMgaDEgdjEgaC0xWiBNMyAyMyBoMSB2MSBoLTFaIE00IDIzIGgxIHYxIGgtMVogTTUgMjMgaDEgdjEgaC0xWiBNNiAyMyBoMSB2MSBoLTFaIE03IDIzIGgxIHYxIGgtMVogTTggMjMgaDEgdjEgaC0xWiBNOSAyMyBoMSB2MSBoLTFaIE0xMCAyMyBoMSB2MSBoLTFaIE0xMSAyMyBoMSB2MSBoLTFaIE0xMiAyMyBoMSB2MSBoLTFaIE0xMyAyMyBoMSB2MSBoLTFaIE0xNCAyMyBoMSB2MSBoLTFaIE0xNSAyMyBoMSB2MSBoLTFaIE0xNiAyMyBoMSB2MSBoLTFaIE0xNyAyMyBoMSB2MSBoLTFaIE0xOCAyMyBoMSB2MSBoLTFaIE0xOSAyMyBoMSB2MSBoLTFaIE0yMCAyMyBoMSB2MSBoLTFaIE0yMSAyMyBoMSB2MSBoLTFaIE0yMiAyMyBoMSB2MSBoLTFaIE0yMyAyMyBoMSB2MSBoLTFaIE0yNCAyMyBoMSB2MSBoLTFaIE0wIDI0IGgxIHYxIGgtMVogTTEgMjQgaDEgdjEgaC0xWiBNMiAyNCBoMSB2MSBoLTFaIE0zIDI0IGgxIHYxIGgtMVogTTQgMjQgaDEgdjEgaC0xWiBNNSAyNCBoMSB2MSBoLTFaIE02IDI0IGgxIHYxIGgtMVogTTcgMjQgaDEgdjEgaC0xWiBNOCAyNCBoMSB2MSBoLTFaIE05IDI0IGgxIHYxIGgtMVogTTEwIDI0IGgxIHYxIGgtMVogTTExIDI0IGgxIHYxIGgtMVogTTEyIDI0IGgxIHYxIGgtMVogTTEzIDI0IGgxIHYxIGgtMVogTTE0IDI0IGgxIHYxIGgtMVogTTE1IDI0IGgxIHYxIGgtMVogTTE2IDI0IGgxIHYxIGgtMVogTTE3IDI0IGgxIHYxIGgtMVogTTE4IDI0IGgxIHYxIGgtMVogTTE5IDI0IGgxIHYxIGgtMVogTTIwIDI0IGgxIHYxIGgtMVogTTIxIDI0IGgxIHYxIGgtMVogTTIyIDI0IGgxIHYxIGgtMVogTTIzIDI0IGgxIHYxIGgtMVogTTI0IDI0IGgxIHYxIGgtMVoiLz4KPHBhdGggY2xhc3M9InFyLWRhcmttb2R1bGUgZGFyayBxcmNvZGUiIGZpbGw9IiMwMDAiIGQ9Ik0xMCAxNSBoMSB2MSBoLTFaIi8+CjxwYXRoIGNsYXNzPSJxci1kYXRhLWRhcmsgZGFyayBxcmNvZGUiIGZpbGw9IiMwMDAiIGQ9Ik0xMiAyIGgxIHYxIGgtMVogTTE0IDIgaDEgdjEgaC0xWiBNMTQgMyBoMSB2MSBoLTFaIE0xMiA0IGgxIHYxIGgtMVogTTE0IDUgaDEgdjEgaC0xWiBNMTEgNiBoMSB2MSBoLTFaIE0xMyA2IGgxIHYxIGgtMVogTTE0IDYgaDEgdjEgaC0xWiBNMTEgNyBoMSB2MSBoLTFaIE0xMiA3IGgxIHYxIGgtMVogTTEzIDcgaDEgdjEgaC0xWiBNMTIgOSBoMSB2MSBoLTFaIE0xMiAxMCBoMSB2MSBoLTFaIE0xNCAxMCBoMSB2MSBoLTFaIE0zIDExIGgxIHYxIGgtMVogTTQgMTEgaDEgdjEgaC0xWiBNNSAxMSBoMSB2MSBoLTFaIE03IDExIGgxIHYxIGgtMVogTTkgMTEgaDEgdjEgaC0xWiBNMTAgMTEgaDEgdjEgaC0xWiBNMTMgMTEgaDEgdjEgaC0xWiBNMTUgMTEgaDEgdjEgaC0xWiBNMTcgMTEgaDEgdjEgaC0xWiBNMTkgMTEgaDEgdjEgaC0xWiBNMjEgMTEgaDEgdjEgaC0xWiBNNSAxMiBoMSB2MSBoLTFaIE03IDEyIGgxIHYxIGgtMVogTTEwIDEyIGgxIHYxIGgtMVogTTEyIDEyIGgxIHYxIGgtMVogTTEzIDEyIGgxIHYxIGgtMVogTTE1IDEyIGgxIHYxIGgtMVogTTE2IDEyIGgxIHYxIGgtMVogTTE3IDEyIGgxIHYxIGgtMVogTTIwIDEyIGgxIHYxIGgtMVogTTIxIDEyIGgxIHYxIGgtMVogTTIyIDEyIGgxIHYxIGgtMVogTTIgMTMgaDEgdjEgaC0xWiBNNSAxMyBoMSB2MSBoLTFaIE02IDEzIGgxIHYxIGgtMVogTTcgMTMgaDEgdjEgaC0xWiBNMTAgMTMgaDEgdjEgaC0xWiBNMTMgMTMgaDEgdjEgaC0xWiBNMTQgMTMgaDEgdjEgaC0xWiBNMTUgMTMgaDEgdjEgaC0xWiBNMTcgMTMgaDEgdjEgaC0xWiBNMTggMTMgaDEgdjEgaC0xWiBNMTkgMTMgaDEgdjEgaC0xWiBNMjEgMTMgaDEgdjEgaC0xWiBNMiAxNCBoMSB2MSBoLTFaIE00IDE0IGgxIHYxIGgtMVogTTUgMTQgaDEgdjEgaC0xWiBNNiAxNCBoMSB2MSBoLTFaIE03IDE0IGgxIHYxIGgtMVogTTkgMTQgaDEgdjEgaC0xWiBNMTMgMTQgaDEgdjEgaC0xWiBNMTUgMTQgaDEgdjEgaC0xWiBNMTYgMTQgaDEgdjEgaC0xWiBNMTcgMTQgaDEgdjEgaC0xWiBNMTkgMTQgaDEgdjEgaC0xWiBNMjAgMTQgaDEgdjEgaC0xWiBNMTEgMTUgaDEgdjEgaC0xWiBNMTIgMTUgaDEgdjEgaC0xWiBNMTYgMTUgaDEgdjEgaC0xWiBNMjIgMTUgaDEgdjEgaC0xWiBNMTIgMTYgaDEgdjEgaC0xWiBNMTQgMTYgaDEgdjEgaC0xWiBNMTggMTYgaDEgdjEgaC0xWiBNMTkgMTYgaDEgdjEgaC0xWiBNMjEgMTYgaDEgdjEgaC0xWiBNMjIgMTYgaDEgdjEgaC0xWiBNMTEgMTcgaDEgdjEgaC0xWiBNMTYgMTcgaDEgdjEgaC0xWiBNMTkgMTcgaDEgdjEgaC0xWiBNMjAgMTcgaDEgdjEgaC0xWiBNMTQgMTggaDEgdjEgaC0xWiBNMTYgMTggaDEgdjEgaC0xWiBNMTggMTggaDEgdjEgaC0xWiBNMjAgMTggaDEgdjEgaC0xWiBNMjIgMTggaDEgdjEgaC0xWiBNMTIgMTkgaDEgdjEgaC0xWiBNMTMgMTkgaDEgdjEgaC0xWiBNMTUgMTkgaDEgdjEgaC0xWiBNMTcgMTkgaDEgdjEgaC0xWiBNMTkgMTkgaDEgdjEgaC0xWiBNMjEgMTkgaDEgdjEgaC0xWiBNMTEgMjAgaDEgdjEgaC0xWiBNMTIgMjAgaDEgdjEgaC0xWiBNMTMgMjAgaDEgdjEgaC0xWiBNMTUgMjAgaDEgdjEgaC0xWiBNMTYgMjAgaDEgdjEgaC0xWiBNMTcgMjAgaDEgdjEgaC0xWiBNMjAgMjAgaDEgdjEgaC0xWiBNMjIgMjAgaDEgdjEgaC0xWiBNMTMgMjEgaDEgdjEgaC0xWiBNMTQgMjEgaDEgdjEgaC0xWiBNMTUgMjEgaDEgdjEgaC0xWiBNMTcgMjEgaDEgdjEgaC0xWiBNMTggMjEgaDEgdjEgaC0xWiBNMTkgMjEgaDEgdjEgaC0xWiBNMjEgMjEgaDEgdjEgaC0xWgpNMTEgMjIgaDEgdjEgaC0xWiBNMTMgMjIgaDEgdjEgaC0xWiBNMTUgMjIgaDEgdjEgaC0xWiBNMTYgMjIgaDEgdjEgaC0xWiBNMTcgMjIgaDEgdjEgaC0xWiBNMjAgMjIgaDEgdjEgaC0xWiBNMjEgMjIgaDEgdjEgaC0xWiBNMjIgMjIgaDEgdjEgaC0xWiIvPgo8cGF0aCBjbGFzcz0icXItZmluZGVyLWRhcmsgZGFyayBxcmNvZGUiIGZpbGw9IiMwMDAiIGQ9Ik0yIDIgaDEgdjEgaC0xWiBNMyAyIGgxIHYxIGgtMVogTTQgMiBoMSB2MSBoLTFaIE01IDIgaDEgdjEgaC0xWiBNNiAyIGgxIHYxIGgtMVogTTcgMiBoMSB2MSBoLTFaIE04IDIgaDEgdjEgaC0xWiBNMTYgMiBoMSB2MSBoLTFaIE0xNyAyIGgxIHYxIGgtMVogTTE4IDIgaDEgdjEgaC0xWiBNMTkgMiBoMSB2MSBoLTFaIE0yMCAyIGgxIHYxIGgtMVogTTIxIDIgaDEgdjEgaC0xWiBNMjIgMiBoMSB2MSBoLTFaIE0yIDMgaDEgdjEgaC0xWiBNOCAzIGgxIHYxIGgtMVogTTE2IDMgaDEgdjEgaC0xWiBNMjIgMyBoMSB2MSBoLTFaIE0yIDQgaDEgdjEgaC0xWiBNOCA0IGgxIHYxIGgtMVogTTE2IDQgaDEgdjEgaC0xWiBNMjIgNCBoMSB2MSBoLTFaIE0yIDUgaDEgdjEgaC0xWiBNOCA1IGgxIHYxIGgtMVogTTE2IDUgaDEgdjEgaC0xWiBNMjIgNSBoMSB2MSBoLTFaIE0yIDYgaDEgdjEgaC0xWiBNOCA2IGgxIHYxIGgtMVogTTE2IDYgaDEgdjEgaC0xWiBNMjIgNiBoMSB2MSBoLTFaIE0yIDcgaDEgdjEgaC0xWiBNOCA3IGgxIHYxIGgtMVogTTE2IDcgaDEgdjEgaC0xWiBNMjIgNyBoMSB2MSBoLTFaIE0yIDggaDEgdjEgaC0xWiBNMyA4IGgxIHYxIGgtMVogTTQgOCBoMSB2MSBoLTFaIE01IDggaDEgdjEgaC0xWiBNNiA4IGgxIHYxIGgtMVogTTcgOCBoMSB2MSBoLTFaIE04IDggaDEgdjEgaC0xWiBNMTYgOCBoMSB2MSBoLTFaIE0xNyA4IGgxIHYxIGgtMVogTTE4IDggaDEgdjEgaC0xWiBNMTkgOCBoMSB2MSBoLTFaIE0yMCA4IGgxIHYxIGgtMVogTTIxIDggaDEgdjEgaC0xWiBNMjIgOCBoMSB2MSBoLTFaIE0yIDE2IGgxIHYxIGgtMVogTTMgMTYgaDEgdjEgaC0xWiBNNCAxNiBoMSB2MSBoLTFaIE01IDE2IGgxIHYxIGgtMVogTTYgMTYgaDEgdjEgaC0xWiBNNyAxNiBoMSB2MSBoLTFaIE04IDE2IGgxIHYxIGgtMVogTTIgMTcgaDEgdjEgaC0xWiBNOCAxNyBoMSB2MSBoLTFaIE0yIDE4IGgxIHYxIGgtMVogTTggMTggaDEgdjEgaC0xWiBNMiAxOSBoMSB2MSBoLTFaIE04IDE5IGgxIHYxIGgtMVogTTIgMjAgaDEgdjEgaC0xWiBNOCAyMCBoMSB2MSBoLTFaIE0yIDIxIGgxIHYxIGgtMVogTTggMjEgaDEgdjEgaC0xWiBNMiAyMiBoMSB2MSBoLTFaIE0zIDIyIGgxIHYxIGgtMVogTTQgMjIgaDEgdjEgaC0xWiBNNSAyMiBoMSB2MSBoLTFaIE02IDIyIGgxIHYxIGgtMVogTTcgMjIgaDEgdjEgaC0xWiBNOCAyMiBoMSB2MSBoLTFaIi8+CjxwYXRoIGNsYXNzPSJxci10aW1pbmctZGFyayBkYXJrIHFyY29kZSIgZmlsbD0iIzAwMCIgZD0iTTEwIDggaDEgdjEgaC0xWiBNMTIgOCBoMSB2MSBoLTFaIE0xNCA4IGgxIHYxIGgtMVogTTggMTAgaDEgdjEgaC0xWiBNOCAxMiBoMSB2MSBoLTFaIE04IDE0IGgxIHYxIGgtMVoiLz4KPHBhdGggY2xhc3M9InFyLWZvcm1hdC1kYXJrIGRhcmsgcXJjb2RlIiBmaWxsPSIjMDAwIiBkPSJNMTAgNCBoMSB2MSBoLTFaIE0xMCA5IGgxIHYxIGgtMVogTTIgMTAgaDEgdjEgaC0xWiBNMyAxMCBoMSB2MSBoLTFaIE00IDEwIGgxIHYxIGgtMVogTTYgMTAgaDEgdjEgaC0xWiBNNyAxMCBoMSB2MSBoLTFaIE05IDEwIGgxIHYxIGgtMVogTTEwIDEwIGgxIHYxIGgtMVogTTE1IDEwIGgxIHYxIGgtMVogTTE2IDEwIGgxIHYxIGgtMVogTTIwIDEwIGgxIHYxIGgtMVogTTEwIDE2IGgxIHYxIGgtMVogTTEwIDE3IGgxIHYxIGgtMVogTTEwIDE4IGgxIHYxIGgtMVogTTEwIDIwIGgxIHYxIGgtMVogTTEwIDIxIGgxIHYxIGgtMVogTTEwIDIyIGgxIHYxIGgtMVoiLz4KPHBhdGggY2xhc3M9InFyLWZpbmRlci1kb3QgZGFyayBxcmNvZGUiIGZpbGw9IiMwMDAiIGQ9Ik00IDQgaDEgdjEgaC0xWiBNNSA0IGgxIHYxIGgtMVogTTYgNCBoMSB2MSBoLTFaIE0xOCA0IGgxIHYxIGgtMVogTTE5IDQgaDEgdjEgaC0xWiBNMjAgNCBoMSB2MSBoLTFaIE00IDUgaDEgdjEgaC0xWiBNNSA1IGgxIHYxIGgtMVogTTYgNSBoMSB2MSBoLTFaIE0xOCA1IGgxIHYxIGgtMVogTTE5IDUgaDEgdjEgaC0xWiBNMjAgNSBoMSB2MSBoLTFaIE00IDYgaDEgdjEgaC0xWiBNNSA2IGgxIHYxIGgtMVogTTYgNiBoMSB2MSBoLTFaIE0xOCA2IGgxIHYxIGgtMVogTTE5IDYgaDEgdjEgaC0xWiBNMjAgNiBoMSB2MSBoLTFaIE00IDE4IGgxIHYxIGgtMVogTTUgMTggaDEgdjEgaC0xWiBNNiAxOCBoMSB2MSBoLTFaIE00IDE5IGgxIHYxIGgtMVogTTUgMTkgaDEgdjEgaC0xWiBNNiAxOSBoMSB2MSBoLTFaIE00IDIwIGgxIHYxIGgtMVogTTUgMjAgaDEgdjEgaC0xWiBNNiAyMCBoMSB2MSBoLTFaIi8+Cjwvc3ZnPgo=';

    private const DECODED_IMAGE = 'otpauth://totp/test@test.com?secret=A4GRFHVIRBGY7UIW';

    protected function setUp() : void
    {
        parent::setUp();
    }

    // #[Test]
    // public function test_encode_returns_correct_value()
    // {
    //     $this->assertEquals(self::STRING_ENCODED, QrCode::encode(self::STRING_TO_ENCODE));
    // }

    #[Test]
    public function test_decode_valid_image_returns_correct_value()
    {
        $file = LocalFile::fake()->validQrcode();

        $this->assertEquals(self::DECODED_IMAGE, QrCode::decode($file));
    }

    #[Test]
    public function test_decode_invalid_image_throws_an_exception()
    {
        $this->expectException(\App\Exceptions\InvalidQrCodeException::class);

        QrCode::decode(LocalFile::fake()->invalidQrcode());
    }

    #[Test]
    #[DataProvider('QrReaderExceptionProvider')]
    public function test_decode_throws_an_exception($exception)
    {
        $this->expectException(\App\Exceptions\InvalidQrCodeException::class);

        // QrReader is a final class, so we need to mock it here with a new object instance
        // to then bind it to the container
        $fileContent = LocalFile::fake()->validQrcode()->get();
        $qrReader    = \Mockery::mock(new QrReader($fileContent, QrReader::SOURCE_TYPE_BLOB))->makePartial();
        $qrReader->shouldReceive('text')->andReturn('');
        $qrReader->shouldReceive('getError')->andReturn($exception);

        $this->app->bind(QrReader::class, function () use ($qrReader) {
            return $qrReader;
        });

        QrCode::decode(LocalFile::fake()->validQrcode());
    }

    public static function QrReaderExceptionProvider()
    {
        return [
            'NotFoundException' => [new NotFoundException],
            'FormatException'   => [new FormatException],
            'ChecksumException' => [new ChecksumException],
            'default'           => [new Exception],
        ];
    }
}
