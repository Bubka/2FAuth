import{r as a,x as P,o as te,v as ue,m as u,d as p,F as le,D as ie,f as o,n as C,u as pe,a as ce,L as fe,R as ve,_ as de,s as me,l as ye,e as S,i as I,j as E,k as _e,t as b,w as Q,X as W,U as ge,z as Y,A as Z,h as V,G as he,J as A,H as F,P as ee}from"./app-C-TXXRMB.js";import{S as we}from"./Spinner-BT_p7WbT.js";/*! 2FAuth version 5.6.0 - Copyright (c) 2025 Bubka - https://github.com/Bubka/2FAuth */const Oe={__name:"TotpLooper",props:{step_count:{type:Number,default:10},period:Number,generated_at:Number,autostart:{type:Boolean,default:!0}},emits:["loop-started","loop-ended","stepped-up"],setup(k,{expose:D,emit:_}){const s=k,f=a(null),h=a(null),T=a(null),g=a(null),v=a(null),i=P(()=>f.value%s.period),r=P(()=>s.period-i.value),d=P(()=>s.period/s.step_count),x=P(()=>{let y=i.value*s.step_count/s.period;return Math.floor(y)+0}),e=_,m=(y=null)=>{l(),f.value=y??s.generated_at,e("loop-started",x.value),v.value=x.value,h.value=setTimeout(function(){l(),e("loop-ended")},r.value*1e3);let w=Math.ceil(i.value/d.value)*d.value-i.value;T.value=setTimeout(function(){w>0&&(v.value+=1,e("stepped-up",v.value)),g.value=setInterval(function(){v.value+=1,e("stepped-up",v.value)},d.value*1e3)},w*1e3)},l=()=>{clearTimeout(h.value),clearTimeout(T.value),clearInterval(g.value),v.value=f.value=null};return te(()=>{s.autostart==!0&&m()}),ue(()=>{l()}),D({startLoop:m,clearLooper:l,props:s}),(y,w)=>(u(),p("div"))}},ke=["data-is-active"],Te={__name:"Dots",props:{stepCount:{type:Number,default:10},initialIndex:{type:Number,default:null},period:{type:Number,default:null}},setup(k,{expose:D}){const _=k,s=a(0),f=P(()=>s.value==-1);function h(g){s.value=g<_.stepCount?g+1:1}function T(){s.value=-1}return te(()=>{isNaN(_.initialIndex)||h(_.initialIndex)}),D({turnOn:h,turnOff:T,props:_}),(g,v)=>(u(),p("ul",{class:C(["dots",{off:o(f)}])},[(u(!0),p(le,null,ie(k.stepCount,i=>(u(),p("li",{key:i,"data-is-active":i==o(s)?!0:null},null,8,ke))),128))],2))}},xe=["src","alt"],Se=["title"],be={key:1,tabindex:"0",class:"otp is-size-1"},Ce={key:0,class:"mt-3 is-size-4"},De=["title"],Ne={key:1},Pe={key:1,class:"mt-3"},Be={__name:"OtpDisplay",props:{otp_type:String,account:String,service:String,icon:String,secret:String,digits:Number,algorithm:String,period:null,counter:null,image:String,qrcode:null,uri:String},emits:["please-close-me","increment-hotp","validation-error"],setup(k,{expose:D,emit:_}){const s=pe(),f=ce(),h=fe("2fauth"),{copy:T,copied:g}=ve({legacy:!0}),v=de(),i=_,r=k,d=a(null),x=a(null),e=a({otp_type:"",account:"",service:"",icon:"",secret:"",digits:null,algorithm:"",period:null,counter:null,image:""}),m=a(""),l=a(""),y=a(null),w=a(!1),$=a(!1),O=a(!1),H=a("0"),L=a(),M=a(),K=a(),R=a(null);me(()=>r.icon,n=>{n!=null&&(e.value.icon=n)});const oe=async n=>{if(O.value=!1,e.value.otp_type=r.otp_type,e.value.account=r.account,e.value.service=r.service,e.value.icon=r.icon,e.value.secret=r.secret,e.value.digits=r.digits,e.value.algorithm=r.algorithm,e.value.period=r.period,e.value.counter=r.counter,q(),n){d.value=n;const{data:t}=await A.get(d.value);e.value.service=t.service,e.value.account=t.account,e.value.icon=t.icon,e.value.otp_type=t.otp_type,B(t.otp_type)&&t.counter&&(e.value.counter=t.counter)}else r.uri?(x.value=r.uri,e.value.otp_type=r.uri.slice(0,15).toLowerCase()==="otpauth://totp/"?"totp":"hotp"):r.secret?!z(e.value.otp_type)&&!B(e.value.otp_type)&&f.error(new Error(F("errors.not_a_supported_otp_type"))):f.error(new Error(F("errors.cannot_create_otp_without_secret")));try{await j(),ne(),s.preferences.getOtpOnRequest&&parseInt(s.preferences.autoCloseTimeout)>0&&ae()}catch{U()}};async function j(){l.value?(m.value=l.value,l.value="",L.value.turnOff(),G(0)):q(),await se().then(n=>{let t=n.data;m.value=t.password,l.value=t.next_password,s.preferences.copyOtpOnDisplay&&N(t.password),z(t.otp_type)?(y.value=t.generated_at,e.value.period=t.period,w.value=!0,ee().then(()=>{M.value.startLoop()})):B(t.otp_type)&&(e.value.counter=t.counter,i("increment-hotp",{nextHotpCounter:t.counter,nextUri:t.uri}))}).catch(n=>{n.response.status===422&&i("validation-error",n.response)}).finally(()=>{$.value=!1})}function q(){$.value=!0,L.value.turnOff()}function se(){return d.value?A.getOtpById(d.value):x.value?A.getOtpByUri(x.value):A.getOtpByParams(e.value)}function J(){i("please-close-me"),O.value=!1,U()}function U(){var n;d.value=e.value.counter=y.value=null,e.value.service=e.value.account=e.value.icon=e.value.otp_type=e.value.secret="",m.value="... ...",l.value="",w.value=!1,clearTimeout(R.value),(n=M.value)==null||n.clearLooper()}function ne(){ee().then(()=>{var n;(n=K.value)==null||n.focus()})}function N(n,t){T(n.replace(/ /g,"")),g&&(s.preferences.kickUserAfter==-1&&(t||!1)===!0&&v.name!="importAccounts"?s.logout({kicked:!0}):s.preferences.closeOtpOnCopy&&(t||!1)===!0&&J(),s.preferences.clearSearchOnCopy&&i("please-clear-search"),s.preferences.viewDefaultGroupOnCopy&&(s.preferences.activeGroup=s.preferences.defaultGroup==-1?s.preferences.activeGroup:s.preferences.defaultGroup),f.success({text:F("commons.copied_to_clipboard")}))}function z(n){return n==="totp"||n==="steamtotp"}function B(n){return n==="hotp"}function G(n){L.value.turnOn(n),H.value="is-opacity-"+n}D({show:oe,clearOTP:U});function ae(){let n=parseInt(s.preferences.autoCloseTimeout);R.value=setTimeout(function(){J()},n*60*1e3)}return(n,t)=>{const X=ye("font-awesome-icon");return u(),p("div",null,[S("figure",{class:C(["image is-64x64",{"no-icon":!o(e).icon}]),style:{display:"inline-flex"}},[o(e).icon?(u(),p("img",{key:0,src:o(h).config.subdirectory+"/storage/icons/"+o(e).icon,alt:n.$t("twofaccounts.icon_to_illustrate_the_account")},null,8,xe)):I("",!0)],2),E(o(ge),null,{default:_e(({mode:c})=>[S("p",{class:C(["is-size-4 has-ellipsis",c=="dark"?"has-text-grey-light":"has-text-grey"])},b(o(e).service),3),S("p",{class:C(["is-size-6 has-ellipsis",c=="dark"?"has-text-grey":"has-text-grey-light"])},b(o(e).account),3),S("p",null,[o($)?(u(),p("span",be,[E(we,{isVisible:o($),type:"raw"},null,8,["isVisible"])])):(u(),p("span",{key:0,id:"otp",role:"log",ref_key:"otpSpanTag",ref:K,tabindex:"0",class:C(["otp is-size-1 is-clickable px-3",c=="dark"?"has-text-white":"has-text-grey-dark"]),onClick:t[0]||(t[0]=re=>N(o(m),!0)),onKeyup:t[1]||(t[1]=Q(re=>N(o(m),!0),["enter"])),title:n.$t("commons.copy_to_clipboard")},b(o(W)(o(m),o(s).preferences.showOtpAsDot&&o(s).preferences.revealDottedOTP&&o(O))),43,Se))])]),_:1}),Y(E(Te,{ref_key:"dots",ref:L},null,512),[[Z,z(o(e).otp_type)]]),Y(S("p",null,b(n.$t("twofaccounts.forms.counter.label"))+": "+b(o(e).counter),513),[[Z,B(o(e).otp_type)]]),o(s).preferences.showNextOtp?(u(),p("p",Ce,[o(l)?(u(),p("span",{key:0,class:C(["is-clickable",o(H)]),onClick:t[2]||(t[2]=c=>N(o(l),!0)),onKeyup:t[3]||(t[3]=Q(c=>N(o(l),!0),["enter"])),title:n.$t("commons.copy_next_password")},b(o(W)(o(l),o(s).preferences.showOtpAsDot&&o(s).preferences.revealDottedOTP&&o(O))),43,De)):(u(),p("span",Ne,"Â "))])):I("",!0),o(s).preferences.showOtpAsDot&&o(s).preferences.revealDottedOTP?(u(),p("p",Pe,[S("button",{type:"button",class:"button is-ghost has-text-grey-dark",onClick:t[4]||(t[4]=he(c=>O.value=!o(O),["stop"]))},[o(O)?(u(),V(X,{key:0,icon:["fas","eye"]})):(u(),V(X,{key:1,icon:["fas","eye-slash"]}))])])):I("",!0),o(w)?(u(),V(Oe,{key:2,period:o(e).period,generated_at:o(y),autostart:!1,onLoopEnded:t[5]||(t[5]=c=>j()),onLoopStarted:t[6]||(t[6]=c=>G(c)),onSteppedUp:t[7]||(t[7]=c=>G(c)),ref_key:"totpLooper",ref:M},null,8,["period","generated_at"])):I("",!0)])}}};export{Be as _,Oe as a,Te as b};
//# sourceMappingURL=OtpDisplay-gZC30mYX.js.map
