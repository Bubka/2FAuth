import{l as v,m as n,d as l,g as _,t as i,j as m,u as D,a as U,R as P,a1 as q,c as z,r as E,o as G,f as t,h as w,k as f,i as c,F as g,L as J,e as o,C as R,w as V,E as M,n as O,p as Q,H as L}from"./app-BActpDYy.js";import{F as X}from"./Form-BYep5rsU.js";import{w as Y}from"./webauthnService-D7nHekpx.js";/*! 2FAuth version 5.4.0 - Copyright (c) 2024 Bubka - https://github.com/Bubka/2FAuth */const Z=["id","href"],H={__name:"SsoConnectLink",props:{provider:{type:String,default:"unknown"}},setup(A){const r=A,b={unknown:{collection:"fa",icon:"globe"},github:{collection:"fab",icon:"github-alt"},openid:{collection:"fab",icon:"openid"}};return(k,h)=>{const d=v("FontAwesomeIcon");return n(),l("a",{id:"lnkSignWith"+r.provider,class:"button is-link",href:"socialite/redirect/"+r.provider},[_(i(k.$t("auth.sso_providers."+r.provider))+" ",1),m(d,{class:"ml-2",icon:[b[r.provider].collection,b[r.provider].icon]},null,8,["icon"])],8,Z)}}},x=["innerHTML"],ee={class:"field"},te={class:"nav-links"},se={key:0,class:"mt-4"},ne={key:1,class:"columns mt-4 is-variable is-1"},oe={class:"column is-narrow py-1"},ie={class:"column py-1"},ae={class:"buttons"},le=["innerHTML"],re=["innerHTML"],ue={class:"nav-links"},de={class:""},ce={class:""},_e={key:2,class:"buttons mt-4"},me={key:3,class:"is-italic"},he={class:"nav-links"},pe=["href"],fe=["innerHTML"],ge=["innerHTML"],ve=["innerHTML"],ye={class:"nav-links"},we=["aria-label"],be={key:0,class:"mt-4"},ke={key:1,class:"columns mt-4 is-variable is-1"},$e={class:"column is-narrow py-1"},Se={class:"column py-1"},Le={class:"buttons"},Me={__name:"Login",setup(A){const r=J("2fauth"),b=Q(),k=D(),h=U(),d=P(),B=k.preferences.useWebauthnOnly?!0:q(r.prefix+"showWebauthnForm",!1),u=z(new X({email:"",password:""})),F=E(!1),p=E();G(()=>{d.enableSso==!0&&d.useSsoOnly==!0?p.value="sso":B.value==!0?p.value="webauthn":p.value="legacy"});function y(e){u.clear(),p.value=e,B.value=p.value=="webauthn"}function K(e){h.clear(),u.post("/user/login",{returnError:!0}).then(async s=>{await k.loginAs({id:s.data.id,name:s.data.name,email:s.data.email,oauth_provider:s.data.oauth_provider,authenticated_by_proxy:!1,preferences:s.data.preferences,isAdmin:s.data.is_admin}),b.push({name:"accounts"})}).catch(s=>{s.response.status===401?h.alert({text:L("auth.forms.authentication_failed"),duration:1e4}):s.response.status!==422&&h.error(s)})}function N(){h.clear(),u.clear(),F.value=!0,Y.authenticate(u.email).then(async e=>{await k.loginAs({id:e.data.id,name:e.data.name,email:e.data.email,oauth_provider:e.data.oauth_provider,authenticated_by_proxy:!1,preferences:e.data.preferences,isAdmin:e.data.is_admin}),b.push({name:"accounts"})}).catch(e=>{"webauthn"in e?e.name=="is-warning"?h.warn({text:L(e.message)}):h.alert({text:L(e.message)}):e.response.status===401?h.alert({text:L("auth.forms.authentication_failed"),duration:1e4}):e.response.status==422?u.errors.set(u.extractErrors(e.response)):h.error(e)}).finally(()=>{F.value=!1})}return(e,s)=>{const W=v("FormField"),C=v("FormButtons"),S=v("RouterLink"),T=v("FormWrapper"),I=v("FormPasswordField"),j=v("VueFooter");return n(),l(g,null,[t(p)=="webauthn"?(n(),w(T,{key:0,title:"auth.forms.webauthn_login",punchline:"auth.welcome_to_2fauth"},{default:f(()=>[t(d).enableSso==!0&&t(d).useSsoOnly==!0?(n(),l("div",{key:0,class:"notification is-warning has-text-centered",innerHTML:e.$t("auth.forms.sso_only_form_restricted_to_admin")},null,8,x)):c("",!0),o("div",ee,i(e.$t("auth.webauthn.use_security_device_to_sign_in")),1),o("form",{id:"frmWebauthnLogin",onSubmit:R(N,["prevent"]),onKeydown:s[1]||(s[1]=a=>t(u).onKeydown(a))},[m(W,{modelValue:t(u).email,"onUpdate:modelValue":s[0]||(s[0]=a=>t(u).email=a),fieldName:"email",fieldError:t(u).errors.get("email"),inputType:"email",label:"auth.forms.email",autofocus:""},null,8,["modelValue","fieldError"]),m(C,{isBusy:t(F),caption:"commons.continue",submitId:"btnContinue"},null,8,["isBusy"])],32),o("div",te,[o("p",null,[_(i(e.$t("auth.webauthn.lost_your_device"))+"  ",1),m(S,{id:"lnkRecoverAccount",to:{name:"webauthn.lost"},class:"is-link"},{default:f(()=>[_(i(e.$t("auth.webauthn.recover_your_account")),1)]),_:1},8,["to"])]),o("p",null,[_(i(e.$t("auth.sign_in_using"))+"  ",1),o("a",{id:"lnkSignWithLegacy",role:"button",class:"is-link",onKeyup:s[2]||(s[2]=V(a=>y("legacy"),["enter"])),onClick:s[3]||(s[3]=a=>y("legacy")),tabindex:"0"},i(e.$t("auth.login_and_password")),33)]),t(d).disableRegistration==!1&&t(d).useSsoOnly==!1?(n(),l("p",se,[_(i(e.$t("auth.forms.dont_have_account_yet"))+"  ",1),m(S,{id:"lnkRegister",to:{name:"register"},class:"is-link"},{default:f(()=>[_(i(e.$t("auth.register")),1)]),_:1})])):c("",!0),t(d).enableSso==!0&&Object.values(t(r).config.sso).includes(!0)?(n(),l("div",ne,[o("div",oe,i(e.$t("auth.or_continue_with")),1),o("div",ie,[o("div",ae,[(n(!0),l(g,null,M(t(r).config.sso,(a,$)=>(n(),l(g,null,[a?(n(),w(H,{key:0,class:O("is-outlined is-small"),provider:$},null,8,["provider"])):c("",!0)],64))),256))])])])):c("",!0)])]),_:1})):t(p)=="sso"?(n(),w(T,{key:1,title:"auth.forms.sso_login",punchline:"auth.welcome_to_2fauth"},{default:f(()=>[t(r).isDemoApp?(n(),l("div",{key:0,class:"notification is-info has-text-centered is-radiusless",innerHTML:e.$t("auth.forms.welcome_to_demo_app_use_those_credentials")},null,8,le)):c("",!0),t(r).isTestingApp?(n(),l("div",{key:1,class:"notification is-warning has-text-centered is-radiusless",innerHTML:e.$t("auth.forms.welcome_to_testing_app_use_those_credentials")},null,8,re)):c("",!0),o("div",ue,[o("p",de,i(e.$t("auth.password_login_and_webauthn_are_disabled")),1),o("p",ce,i(e.$t("auth.sign_in_using_sso")),1)]),Object.values(t(r).config.sso).includes(!0)?(n(),l("div",_e,[(n(!0),l(g,null,M(t(r).config.sso,(a,$)=>(n(),l(g,null,[a?(n(),w(H,{key:0,provider:$},null,8,["provider"])):c("",!0)],64))),256))])):(n(),l("p",me,"- "+i(e.$t("auth.no_provider"))+" -",1)),o("div",he,[o("p",null,[_(i(e.$t("auth.no_sso_provider_or_provider_is_missing"))+"  ",1),o("a",{id:"lnkSsoDocs",class:"is-link",tabindex:"0",href:t(r).urls.ssoDocUrl,target:"_blank"},i(e.$t("auth.see_how_to_enable_sso")),9,pe)]),o("p",null,[_(i(e.$t("auth.if_administrator"))+"  ",1),o("a",{id:"lnkSignWithLegacy",role:"button",class:"is-link",onKeyup:s[4]||(s[4]=V(a=>y("legacy"),["enter"])),onClick:s[5]||(s[5]=a=>y("legacy")),tabindex:"0"},i(e.$t("auth.sign_in_here")),33)])])]),_:1})):t(p)=="legacy"?(n(),w(T,{key:2,title:"auth.forms.login",punchline:"auth.welcome_to_2fauth"},{default:f(()=>[t(r).isDemoApp?(n(),l("div",{key:0,class:"notification is-info has-text-centered is-radiusless",innerHTML:e.$t("auth.forms.welcome_to_demo_app_use_those_credentials")},null,8,fe)):c("",!0),t(r).isTestingApp?(n(),l("div",{key:1,class:"notification is-warning has-text-centered is-radiusless",innerHTML:e.$t("auth.forms.welcome_to_testing_app_use_those_credentials")},null,8,ge)):c("",!0),t(d).enableSso==!0&&t(d).useSsoOnly==!0?(n(),l("div",{key:2,class:"notification is-warning has-text-centered",innerHTML:e.$t("auth.forms.sso_only_form_restricted_to_admin")},null,8,ve)):c("",!0),o("form",{id:"frmLegacyLogin",onSubmit:R(K,["prevent"]),onKeydown:s[8]||(s[8]=a=>t(u).onKeydown(a))},[m(W,{modelValue:t(u).email,"onUpdate:modelValue":s[6]||(s[6]=a=>t(u).email=a),fieldName:"email",fieldError:t(u).errors.get("email"),inputType:"email",label:"auth.forms.email",autofocus:""},null,8,["modelValue","fieldError"]),m(I,{modelValue:t(u).password,"onUpdate:modelValue":s[7]||(s[7]=a=>t(u).password=a),fieldName:"password",fieldError:t(u).errors.get("password"),label:"auth.forms.password"},null,8,["modelValue","fieldError"]),m(C,{isBusy:t(u).isBusy,caption:"auth.sign_in",submitId:"btnSignIn"},null,8,["isBusy"])],32),o("div",ye,[o("p",null,[_(i(e.$t("auth.forms.forgot_your_password"))+"  ",1),m(S,{id:"lnkResetPwd",to:{name:"password.request"},class:"is-link","aria-label":e.$t("auth.forms.reset_your_password")},{default:f(()=>[_(i(e.$t("auth.forms.request_password_reset")),1)]),_:1},8,["to","aria-label"])]),o("p",null,[_(i(e.$t("auth.sign_in_using"))+"  ",1),o("a",{id:"lnkSignWithWebauthn",role:"button",class:"is-link",onKeyup:s[9]||(s[9]=V(a=>y("webauthn"),["enter"])),onClick:s[10]||(s[10]=a=>y("webauthn")),tabindex:"0","aria-label":e.$t("auth.sign_in_using_security_device")},i(e.$t("auth.webauthn.security_device")),41,we)]),t(d).disableRegistration==!1&&t(d).useSsoOnly==!1?(n(),l("p",be,[_(i(e.$t("auth.forms.dont_have_account_yet"))+"  ",1),m(S,{id:"lnkRegister",to:{name:"register"},class:"is-link"},{default:f(()=>[_(i(e.$t("auth.register")),1)]),_:1})])):c("",!0),t(d).enableSso&&Object.values(t(r).config.sso).includes(!0)?(n(),l("div",ke,[o("div",$e,i(e.$t("auth.or_continue_with")),1),o("div",Se,[o("div",Le,[(n(!0),l(g,null,M(t(r).config.sso,(a,$)=>(n(),l(g,null,[a?(n(),w(H,{key:0,class:O("is-outlined is-small"),provider:$},null,8,["provider"])):c("",!0)],64))),256))])])])):c("",!0)])]),_:1})):c("",!0),m(j)],64)}}};export{Me as default};
