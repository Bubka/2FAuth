{"version":3,"file":"Login-D3SXCqQw.js","sources":["../../../resources/js/components/SsoConnectLink.vue","../../../resources/js/views/auth/Login.vue"],"sourcesContent":["<script setup>\n    const props = defineProps({\n        provider: {\n            type: String,\n            default: 'unknown'\n        }\n    })\n\n    const icons = {\n        unknown: {\n            collection: 'fa',\n            icon: 'globe',\n        },\n        github: {\n            collection: 'fab',\n            icon: 'github-alt',\n        },\n        openid: {\n            collection: 'fab',\n            icon: 'openid',\n        }\n    }\n</script>\n\n<template>\n    <a :id=\"'lnkSignWith' + props.provider\" class=\"button is-link\" :href=\"'socialite/redirect/' + props.provider\">\n        {{ $t('auth.sso_providers.' + props.provider) }}\n        <FontAwesomeIcon class=\"ml-2\" :icon=\"[icons[props.provider].collection, icons[props.provider].icon]\" />\n    </a>\n</template>\n\n","<script setup>\n    import Form from '@/components/formElements/Form'\n    import SsoConnectLink from '@/components/SsoConnectLink.vue'\n    import { useUserStore } from '@/stores/user'\n    import { useNotifyStore } from '@/stores/notify'\n    import { useAppSettingsStore } from '@/stores/appSettings'\n    import { webauthnService } from '@/services/webauthn/webauthnService'\n\n    const $2fauth = inject('2fauth')\n    const router = useRouter()\n    const user = useUserStore()\n    const notify = useNotifyStore()\n    const appSettings = useAppSettingsStore()\n    const showWebauthnForm = user.preferences.useWebauthnOnly ? true : useStorage($2fauth.prefix + 'showWebauthnForm', false) \n    const form = reactive(new Form({\n        email: '',\n        password: ''\n    }))\n    const isBusy = ref(false)\n    const activeForm = ref()\n\n    onMounted(() => {\n        if (appSettings.enableSso == true && appSettings.useSsoOnly == true) {\n            activeForm.value = 'sso'\n        }\n        else if (showWebauthnForm.value == true) {\n            activeForm.value = 'webauthn'\n        }\n        else activeForm.value = 'legacy'\n    })\n\n    \n\n    /**\n     * Toggle the form between legacy and webauthn method\n     */\n    function switchToForm(formName) {\n        form.clear()\n        activeForm.value = formName\n        showWebauthnForm.value = activeForm.value == 'webauthn'\n    }\n\n    /**\n     * Sign in using the login/password form\n     */\n    function LegacysignIn(e) {\n        notify.clear()\n        isBusy.value = true\n\n        form.post('/user/login', {returnError: true}).then(async (response) => {\n            await user.loginAs({\n                id: response.data.id,\n                name: response.data.name,\n                email: response.data.email,\n                oauth_provider: response.data.oauth_provider,\n                authenticated_by_proxy: false,\n                preferences: response.data.preferences,\n                isAdmin: response.data.is_admin,\n            })\n\n            router.push({ name: 'accounts' })\n        })\n        .catch(error => {\n            if( error.response.status === 401 ) {\n                notify.alert({text: trans('auth.forms.authentication_failed'), duration: 10000 })\n            }\n            else if( error.response.status !== 422 ) {\n                notify.error(error)\n            }\n        })\n        .finally(() => {\n            isBusy.value = false\n        })\n    }\n\n    /**\n     * Sign in using webauthn\n     */\n    function webauthnLogin() {\n        notify.clear()\n        form.clear()\n        isBusy.value = true\n\n        webauthnService.authenticate(form.email).then(async (response) => {\n            await user.loginAs({\n                id: response.data.id,\n                name: response.data.name,\n                email: response.data.email,\n                oauth_provider: response.data.oauth_provider,\n                authenticated_by_proxy: false,\n                preferences: response.data.preferences,\n                isAdmin: response.data.is_admin,\n            })\n\n            router.push({ name: 'accounts' })\n        })\n        .catch(error => {\n            if ('webauthn' in error) {\n                if (error.name == 'is-warning') {\n                    notify.warn({ text: trans(error.message) })\n                }\n                else notify.alert({ text: trans(error.message) })\n            }\n            else if( error.response.status === 401 ) {\n                notify.alert({text: trans('auth.forms.authentication_failed'), duration: 10000 })\n            }\n            else if( error.response.status == 422 ) {\n                form.errors.set(form.extractErrors(error.response))\n            }\n            else {\n                notify.error(error)\n            }\n        })\n        .finally(() => {\n            isBusy.value = false\n        })\n    }\n\n</script>\n\n<template>\n    <!-- webauthn authentication -->\n    <FormWrapper v-if=\"activeForm == 'webauthn'\" title=\"auth.forms.webauthn_login\" punchline=\"auth.welcome_to_2fauth\">\n        <div v-if=\"appSettings.enableSso == true && appSettings.useSsoOnly == true\" class=\"notification is-warning has-text-centered\" v-html=\"$t('auth.forms.sso_only_form_restricted_to_admin')\" />\n        <div class=\"field\">\n            {{ $t('auth.webauthn.use_security_device_to_sign_in') }}\n        </div>\n        <form id=\"frmWebauthnLogin\" @submit.prevent=\"webauthnLogin\" @keydown=\"form.onKeydown($event)\">\n            <FormField v-model=\"form.email\" fieldName=\"email\" :fieldError=\"form.errors.get('email')\" inputType=\"email\" label=\"auth.forms.email\" autofocus />\n            <FormButtons :isBusy=\"isBusy\" caption=\"commons.continue\" submitId=\"btnContinue\"/>\n        </form>\n        <div class=\"nav-links\">\n            <p>\n                {{ $t('auth.webauthn.lost_your_device') }}&nbsp;\n                <RouterLink id=\"lnkRecoverAccount\" :to=\"{ name: 'webauthn.lost' }\" class=\"is-link\">\n                    {{ $t('auth.webauthn.recover_your_account') }}\n                </RouterLink>\n            </p>\n            <p>{{ $t('auth.sign_in_using') }}&nbsp;\n                <a id=\"lnkSignWithLegacy\" role=\"button\" class=\"is-link\" @keyup.enter=\"switchToForm('legacy')\" @click=\"switchToForm('legacy')\" tabindex=\"0\">\n                    {{ $t('auth.login_and_password') }}\n                </a>\n            </p>\n            <p v-if=\"appSettings.disableRegistration == false && appSettings.useSsoOnly == false\" class=\"mt-4\">\n                {{ $t('auth.forms.dont_have_account_yet') }}&nbsp;\n                <RouterLink id=\"lnkRegister\" :to=\"{ name: 'register' }\" class=\"is-link\">\n                    {{ $t('auth.register') }}\n                </RouterLink>\n            </p>\n            <div v-if=\"appSettings.enableSso == true && Object.values($2fauth.config.sso).includes(true)\" class=\"columns mt-4 is-variable is-1\">\n                <div class=\"column is-narrow py-1\">\n                    {{ $t('auth.or_continue_with') }}\n                </div>\n                <div class=\"column py-1\">\n                    <div class=\"buttons\">\n                        <template v-for=\"(isEnabled, provider) in $2fauth.config.sso\">\n                            <SsoConnectLink v-if=\"isEnabled\" :class=\"'is-outlined is-small'\" :provider=\"provider\" />\n                        </template>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </FormWrapper>\n    <!-- SSO only links -->\n    <FormWrapper v-else-if=\"activeForm == 'sso'\" title=\"auth.forms.sso_login\" punchline=\"auth.welcome_to_2fauth\">\n        <div v-if=\"$2fauth.isDemoApp\" class=\"notification is-info has-text-centered is-radiusless\" v-html=\"$t('auth.forms.welcome_to_demo_app_use_those_credentials')\" />\n        <div v-if=\"$2fauth.isTestingApp\" class=\"notification is-warning has-text-centered is-radiusless\" v-html=\"$t('auth.forms.welcome_to_testing_app_use_those_credentials')\" />\n        <div class=\"nav-links\">\n            <p class=\"\">{{ $t('auth.password_login_and_webauthn_are_disabled') }}</p>\n            <p class=\"\">{{ $t('auth.sign_in_using_sso') }}</p>\n        </div>\n        <div v-if=\"Object.values($2fauth.config.sso).includes(true)\" class=\"buttons mt-4\">\n            <template v-for=\"(isEnabled, provider) in $2fauth.config.sso\">\n                <SsoConnectLink v-if=\"isEnabled\" :provider=\"provider\" />\n            </template>\n        </div>\n        <p v-else class=\"is-italic\">- {{ $t('auth.no_provider') }} -</p>\n        <div class=\"nav-links\">\n            <p>\n                {{ $t('auth.no_sso_provider_or_provider_is_missing') }}&nbsp;\n                <a id=\"lnkSsoDocs\" class=\"is-link\" tabindex=\"0\" :href=\"$2fauth.urls.ssoDocUrl\" target=\"_blank\">\n                    {{ $t('auth.see_how_to_enable_sso') }}\n                </a>\n            </p>\n            <p >{{ $t('auth.if_administrator') }}&nbsp;\n                <a id=\"lnkSignWithLegacy\" role=\"button\" class=\"is-link\" @keyup.enter=\"switchToForm('legacy')\" @click=\"switchToForm('legacy')\" tabindex=\"0\">\n                    {{ $t('auth.sign_in_here') }}\n                </a>\n            </p>\n        </div>\n    </FormWrapper>\n    <!-- login/password legacy form -->\n    <FormWrapper v-else-if=\"activeForm == 'legacy'\" title=\"auth.forms.login\" punchline=\"auth.welcome_to_2fauth\">\n        <div v-if=\"$2fauth.isDemoApp\" class=\"notification is-info has-text-centered is-radiusless\" v-html=\"$t('auth.forms.welcome_to_demo_app_use_those_credentials')\" />\n        <div v-if=\"$2fauth.isTestingApp\" class=\"notification is-warning has-text-centered is-radiusless\" v-html=\"$t('auth.forms.welcome_to_testing_app_use_those_credentials')\" />\n        <div v-if=\"appSettings.enableSso == true && appSettings.useSsoOnly == true\" class=\"notification is-warning has-text-centered\" v-html=\"$t('auth.forms.sso_only_form_restricted_to_admin')\" />\n        <form id=\"frmLegacyLogin\" @submit.prevent=\"LegacysignIn\" @keydown=\"form.onKeydown($event)\">\n            <FormField v-model=\"form.email\" fieldName=\"email\" :fieldError=\"form.errors.get('email')\" inputType=\"email\" label=\"auth.forms.email\" autocomplete=\"username\" autofocus />\n            <FormPasswordField v-model=\"form.password\" fieldName=\"password\" :fieldError=\"form.errors.get('password')\" label=\"auth.forms.password\" autocomplete=\"current-password\" />\n            <FormButtons :isBusy=\"isBusy\" caption=\"auth.sign_in\" submitId=\"btnSignIn\"/>\n        </form>\n        <div class=\"nav-links\">\n            <p>{{ $t('auth.forms.forgot_your_password') }}&nbsp;\n                <RouterLink id=\"lnkResetPwd\" :to=\"{ name: 'password.request' }\" class=\"is-link\" :aria-label=\"$t('auth.forms.reset_your_password')\">\n                    {{ $t('auth.forms.request_password_reset') }}\n                </RouterLink>\n            </p>\n            <p >{{ $t('auth.sign_in_using') }}&nbsp;\n                <a id=\"lnkSignWithWebauthn\" role=\"button\" class=\"is-link\" @keyup.enter=\"switchToForm('webauthn')\" @click=\"switchToForm('webauthn')\" tabindex=\"0\" :aria-label=\"$t('auth.sign_in_using_security_device')\">\n                    {{ $t('auth.webauthn.security_device') }}\n                </a>\n            </p>\n            <p v-if=\"appSettings.disableRegistration == false && appSettings.useSsoOnly == false\" class=\"mt-4\">\n                {{ $t('auth.forms.dont_have_account_yet') }}&nbsp;\n                <RouterLink id=\"lnkRegister\" :to=\"{ name: 'register' }\" class=\"is-link\">\n                    {{ $t('auth.register') }}\n                </RouterLink>\n            </p>\n            <div v-if=\"appSettings.enableSso && Object.values($2fauth.config.sso).includes(true)\" class=\"columns mt-4 is-variable is-1\">\n                <div class=\"column is-narrow py-1\">\n                    {{ $t('auth.or_continue_with') }}\n                </div>\n                <div class=\"column py-1\">\n                    <div class=\"buttons\">\n                        <template v-for=\"(isEnabled, provider) in $2fauth.config.sso\">\n                            <SsoConnectLink v-if=\"isEnabled\" :class=\"'is-outlined is-small'\" :provider=\"provider\" />\n                        </template>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </FormWrapper>\n    <!-- footer -->\n    <VueFooter/>\n</template>\n"],"names":["props","__props","icons","$2fauth","inject","router","useRouter","user","useUserStore","notify","useNotifyStore","appSettings","useAppSettingsStore","showWebauthnForm","useStorage","form","reactive","Form","isBusy","ref","activeForm","onMounted","switchToForm","formName","LegacysignIn","response","error","trans","webauthnLogin","webauthnService"],"mappings":"mfACI,MAAMA,EAAQC,EAORC,EAAQ,CACV,QAAS,CACL,WAAY,KACZ,KAAM,OACT,EACD,OAAQ,CACJ,WAAY,MACZ,KAAM,YACT,EACD,OAAQ,CACJ,WAAY,MACZ,KAAM,QAClB,CACA,w8BCbI,MAAMC,EAAUC,EAAO,QAAQ,EACzBC,EAASC,EAAS,EAClBC,EAAOC,EAAY,EACnBC,EAASC,EAAc,EACvBC,EAAcC,EAAmB,EACjCC,EAAmBN,EAAK,YAAY,gBAAkB,GAAOO,EAAWX,EAAQ,OAAS,mBAAoB,EAAK,EAClHY,EAAOC,EAAS,IAAIC,EAAK,CAC3B,MAAO,GACP,SAAU,EAClB,CAAK,CAAC,EACIC,EAASC,EAAI,EAAK,EAClBC,EAAaD,EAAG,EAEtBE,EAAU,IAAM,CACRV,EAAY,WAAa,IAAQA,EAAY,YAAc,GAC3DS,EAAW,MAAQ,MAEdP,EAAiB,OAAS,GAC/BO,EAAW,MAAQ,WAElBA,EAAW,MAAQ,QAC3B,CAAA,EAOD,SAASE,EAAaC,EAAU,CAC5BR,EAAK,MAAK,EACVK,EAAW,MAAQG,EACnBV,EAAiB,MAAQO,EAAW,OAAS,UACrD,CAKI,SAASI,EAAa,EAAG,CACrBf,EAAO,MAAK,EACZS,EAAO,MAAQ,GAEfH,EAAK,KAAK,cAAe,CAAC,YAAa,EAAI,CAAC,EAAE,KAAK,MAAOU,GAAa,CACnE,MAAMlB,EAAK,QAAQ,CACf,GAAIkB,EAAS,KAAK,GAClB,KAAMA,EAAS,KAAK,KACpB,MAAOA,EAAS,KAAK,MACrB,eAAgBA,EAAS,KAAK,eAC9B,uBAAwB,GACxB,YAAaA,EAAS,KAAK,YAC3B,QAASA,EAAS,KAAK,QAC1B,CAAA,EAEDpB,EAAO,KAAK,CAAE,KAAM,UAAY,CAAA,CACnC,CAAA,EACA,MAAMqB,GAAS,CACRA,EAAM,SAAS,SAAW,IAC1BjB,EAAO,MAAM,CAAC,KAAMkB,EAAM,kCAAkC,EAAG,SAAU,GAAO,CAAA,EAE3ED,EAAM,SAAS,SAAW,KAC/BjB,EAAO,MAAMiB,CAAK,CAEzB,CAAA,EACA,QAAQ,IAAM,CACXR,EAAO,MAAQ,EAClB,CAAA,CACT,CAKI,SAASU,GAAgB,CACrBnB,EAAO,MAAK,EACZM,EAAK,MAAK,EACVG,EAAO,MAAQ,GAEfW,EAAgB,aAAad,EAAK,KAAK,EAAE,KAAK,MAAOU,GAAa,CAC9D,MAAMlB,EAAK,QAAQ,CACf,GAAIkB,EAAS,KAAK,GAClB,KAAMA,EAAS,KAAK,KACpB,MAAOA,EAAS,KAAK,MACrB,eAAgBA,EAAS,KAAK,eAC9B,uBAAwB,GACxB,YAAaA,EAAS,KAAK,YAC3B,QAASA,EAAS,KAAK,QAC1B,CAAA,EAEDpB,EAAO,KAAK,CAAE,KAAM,UAAY,CAAA,CACnC,CAAA,EACA,MAAMqB,GAAS,CACR,aAAcA,EACVA,EAAM,MAAQ,aACdjB,EAAO,KAAK,CAAE,KAAMkB,EAAMD,EAAM,OAAO,CAAG,CAAA,EAEzCjB,EAAO,MAAM,CAAE,KAAMkB,EAAMD,EAAM,OAAO,CAAG,CAAA,EAE3CA,EAAM,SAAS,SAAW,IAC/BjB,EAAO,MAAM,CAAC,KAAMkB,EAAM,kCAAkC,EAAG,SAAU,GAAO,CAAA,EAE3ED,EAAM,SAAS,QAAU,IAC9BX,EAAK,OAAO,IAAIA,EAAK,cAAcW,EAAM,QAAQ,CAAC,EAGlDjB,EAAO,MAAMiB,CAAK,CAEzB,CAAA,EACA,QAAQ,IAAM,CACXR,EAAO,MAAQ,EAClB,CAAA,CACT"}