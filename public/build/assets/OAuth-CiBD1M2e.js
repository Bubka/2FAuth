import{a7 as G,a as R,u as q,a8 as J,R as Q,r as h,x as X,o as Y,c as Z,I as x,a6 as ee,d as r,j as a,e as o,k as _,f as s,i as d,L as se,l as m,m as i,t as n,w as te,g,F as oe,D as ne,h as ae,U as ie,n as z,G as L,H as y}from"./app-TUxKuQ-n.js";import{F as le}from"./Form-D3XANk6f.js";import{_ as re}from"./SettingTabs-BsmTvkcB.js";import{S as ce}from"./Spinner-DmQltsni.js";/*! 2FAuth version 5.6.1 - Copyright (c) 2025 Bubka - https://github.com/Bubka/2FAuth */const ue={class:"options-tabs"},de={key:0,class:"notification is-warning has-text-centered"},_e=["innerHTML"],me={class:"title is-4 has-text-grey-light"},pe={class:"is-size-7-mobile"},he={class:"mt-3"},fe={key:2},ve={class:"tags is-pulled-right"},ke=["onClick"],ge=["onClick","title"],ye={key:1,class:"is-size-7-mobile is-size-6 my-3"},be={key:2,class:"pat is-family-monospace is-size-6 is-size-7-mobile has-text-success"},Te={class:"mt-2 is-size-7 is-pulled-right"},we={key:0,class:"is-overlay modal-otp modal-background"},Ce={class:"main-section"},Fe={class:"field is-grouped"},$e={class:"control"},Ve={class:"control"},Le={__name:"OAuth",setup(Se){const b=G(),P=se("2fauth"),p=R(),T=q(),E=J(P.prefix+"returnTo","accounts"),{copy:M}=Q({legacy:!0}),c=h([]),w=h(!1),f=h(!1),v=h(null),C=h(null),F=X(()=>b.enableSso&&b.useSsoOnly&&!b.allowPatWhileSsoOnly||T.authenticated_by_proxy);Y(()=>{$()});const u=Z(new le({name:""}));function $(){w.value=!0,x.getPersonalAccessTokens({returnError:!0}).then(e=>{c.value=[],e.data.forEach(l=>{l.id===C.value?(l.value=v.value,c.value.unshift(l)):c.value.push(l)})}).catch(e=>{e.response.status===403||p.error(e)}).finally(()=>{w.value=!1,C.value=null,v.value=null})}function V(){K(),F.value?p.warn({text:y("errors.unsupported_with_reverseproxy")}):f.value=!0}function N(){u.post("/oauth/personal-access-tokens").then(e=>{v.value=e.data.accessToken,C.value=e.data.token.id,$(),f.value=!1,u.reset()})}function I(e){confirm(y("settings.confirm.revoke"))&&x.deletePersonalAccessToken(e).then(l=>{c.value=c.value.filter(k=>k.id!==e),p.success({text:y("settings.token_revoked")})})}function K(){c.value.forEach(e=>{e.value=null}),v.value=null}function O(e){M(e),p.success({text:y("commons.copied_to_clipboard")})}function U(){f.value=!1,u.reset()}return ee(e=>{e.name.startsWith("settings.")||p.clear()}),(e,l)=>{const k=m("FontAwesomeIcon"),W=m("ButtonBackCloseCancel"),D=m("VueFooter"),S=m("FormWrapper"),H=m("FormField"),B=m("VueButton");return i(),r("div",null,[a(re,{activeTab:"settings.oauth.tokens"}),o("div",ue,[a(S,null,{default:_(()=>[s(F)&&s(T).oauth_provider?(i(),r("div",de,n(e.$t("auth.sso_only_x_settings_are_disabled",{auth_method:"OAuth"})),1)):d("",!0),s(F)&&s(T).authenticated_by_proxy?(i(),r("div",{key:1,class:"notification is-warning has-text-centered",innerHTML:e.$t("auth.auth_handled_by_proxy")},null,8,_e)):d("",!0),o("h4",me,n(e.$t("settings.personal_access_tokens")),1),o("div",pe,n(e.$t("settings.token_legend")),1),o("div",he,[o("a",{tabindex:"0",class:"is-link",onClick:V,onKeyup:te(V,["enter"])},[a(k,{icon:["fas","plus-circle"]}),g(" "+n(e.$t("settings.generate_new_token")),1)],32)]),s(c).length>0?(i(),r("div",fe,[(i(!0),r(oe,null,ne(s(c),t=>(i(),r("div",{key:t.id,class:"group-item is-size-5 is-size-6-mobile"},[t.value?(i(),ae(k,{key:0,class:"has-text-success",icon:["fas","check"]})):d("",!0),g(" "+n(t.name)+" ",1),o("div",ve,[a(s(ie),null,{default:_(({mode:A})=>[t.value?(i(),r("button",{key:0,type:"button",class:z(["button tag",{"is-link":A!="dark"}]),onClick:L(j=>O(t.value),["stop"])},n(e.$t("commons.copy")),11,ke)):d("",!0),o("button",{type:"button",class:z(["button tag",A==="dark"?"is-dark":"is-white"]),onClick:j=>I(t.id),title:e.$t("settings.revoke")},n(e.$t("settings.revoke")),11,ge)]),_:2},1024)]),t.value?(i(),r("span",ye,n(e.$t("settings.make_sure_copy_token")),1)):d("",!0),t.value?(i(),r("span",be,n(t.value),1)):d("",!0)]))),128)),o("div",Te,n(e.$t("settings.revoking_a_token_is_permanent")),1)])):d("",!0),a(ce,{isVisible:s(w)&&s(c).length===0},null,8,["isVisible"]),a(D,{showButtons:!0},{default:_(()=>[a(W,{returnTo:{name:s(E)},action:"close"},null,8,["returnTo"])]),_:1})]),_:1})]),s(f)?(i(),r("div",we,[o("main",Ce,[a(S,{title:"settings.forms.new_token"},{default:_(()=>[o("form",{onSubmit:L(N,["prevent"]),onKeydown:l[1]||(l[1]=t=>s(u).onKeydown(t))},[a(H,{modelValue:s(u).name,"onUpdate:modelValue":l[0]||(l[0]=t=>s(u).name=t),fieldName:"name",fieldError:s(u).errors.get("name"),inputType:"text",label:"commons.name",autofocus:""},null,8,["modelValue","fieldError"]),o("div",Fe,[o("div",$e,[a(B,{id:"btnGenerateToken",isLoading:s(u).isBusy},{default:_(()=>[g(n(e.$t("commons.generate")),1)]),_:1},8,["isLoading"])]),o("div",Ve,[a(B,{onClick:U,nativeType:"button",id:"btnCancel",color:"is-text"},{default:_(()=>[g(n(e.$t("commons.cancel")),1)]),_:1})])])],32)]),_:1})])])):d("",!0)])}}};export{Le as default};
