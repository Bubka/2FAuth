{"version":3,"file":"Register-B5uDa2ha.js","sources":["../../../resources/js/views/auth/Register.vue"],"sourcesContent":["<script setup>\n    import Form from '@/components/formElements/Form'\n    import { useUserStore } from '@/stores/user'\n    import { webauthnService } from '@/services/webauthn/webauthnService'\n    import { useNotifyStore } from '@/stores/notify'\n\n    const user = useUserStore()\n    const notify = useNotifyStore()\n    const router = useRouter()\n    const showWebauthnRegistration = ref(false)\n    const deviceId = ref(null)\n    \n    const registerForm = reactive(new Form({\n        name : '',\n        email : '',\n        password : '',\n        password_confirmation : '',\n    }))\n\n    const renameDeviceForm = reactive(new Form({\n        name : ''\n    }))\n\n    /**\n     * Register a new user\n     */\n    async function register(e) {\n        registerForm.password_confirmation = registerForm.password\n\n        registerForm.post('/user').then(response => {\n            user.$patch({\n                name: response.data.name,\n                email: response.data.email,\n                preferences: response.data.preferences,\n                isAdmin: response.data.is_admin ?? false,\n                // TODO : add 'id' to the response\n            })\n            user.applyTheme()\n\n            showWebauthnRegistration.value = true\n        })\n    }    \n\n    /**\n     * Register a new security device\n     */\n    function registerWebauthnDevice() {\n        webauthnService.register().then((response) => {\n            const publicKeyCredential = JSON.parse(response.config.data)\n\n            deviceId.value = publicKeyCredential.id\n        })\n        .catch(error => {\n            if( error.response.status === 422 ) {\n                notify.alert({ text: error.response.data.message })\n            }\n            else {\n                notify.error(error);\n            }\n        })\n    }\n\n    /**\n     * Rename the registered device\n     */\n    function RenameDevice(e) {\n        renameDeviceForm.patch('/webauthn/credentials/' + deviceId.value + '/name')\n        .then(() => {\n            notify.success({ text: trans('auth.webauthn.device_successfully_registered') })\n            router.push({ name: 'accounts' })\n        })\n    }\n\n    onBeforeRouteLeave(() => {\n        notify.clear()\n    })\n</script>\n\n<template>\n    <div>\n        <!-- webauthn registration -->\n        <FormWrapper v-if=\"showWebauthnRegistration\" title=\"auth.authentication\" punchline=\"auth.webauthn.enhance_security_using_webauthn\">\n            <div v-if=\"deviceId\" class=\"field\">\n                <label id=\"lblDeviceRegistrationSuccess\" class=\"label mb-5\">{{ $t('auth.webauthn.device_successfully_registered') }}&nbsp;<font-awesome-icon :icon=\"['fas', 'check']\" /></label>\n                <form @submit.prevent=\"RenameDevice\" @keydown=\"renameDeviceForm.onKeydown($event)\">\n                    <FormField v-model=\"renameDeviceForm.name\" fieldName=\"name\" :fieldError=\"renameDeviceForm.errors.get('name')\" inputType=\"text\" placeholder=\"iPhone 12, TouchID, Yubikey 5C\" label=\"auth.forms.name_this_device\" />\n                    <FormButtons :isBusy=\"renameDeviceForm.isBusy\" :isDisabled=\"renameDeviceForm.isDisabled\" caption=\"commons.continue\" />\n                </form>\n            </div>\n            <div v-else class=\"field is-grouped\">\n                <!-- register button -->\n                <div class=\"control\">\n                    <button type=\"button\" id=\"btnRegisterNewDevice\" @click=\"registerWebauthnDevice()\" class=\"button is-link\">{{ $t('auth.webauthn.register_a_device') }}</button>\n                </div>\n                <!-- dismiss button -->\n                <div class=\"control\">\n                    <RouterLink id=\"btnMaybeLater\" :to=\"{ name: 'accounts' }\" class=\"button is-text\">{{ $t('auth.maybe_later') }}</RouterLink>\n                </div>\n            </div>\n        </FormWrapper>\n        <!-- User registration form -->\n        <FormWrapper v-else title=\"auth.register\" punchline=\"auth.forms.register_punchline\">\n            <form @submit.prevent=\"register\" @keydown=\"registerForm.onKeydown($event)\">\n                <FormField v-model=\"registerForm.name\" fieldName=\"name\" :fieldError=\"registerForm.errors.get('name')\" inputType=\"text\" label=\"auth.forms.name\" autocomplete=\"username\" :maxLength=\"255\" autofocus />\n                <FormField v-model=\"registerForm.email\" fieldName=\"email\" :fieldError=\"registerForm.errors.get('email')\" inputType=\"email\" label=\"auth.forms.email\" autocomplete=\"email\" :maxLength=\"255\" />\n                <FormPasswordField v-model=\"registerForm.password\" fieldName=\"password\" :fieldError=\"registerForm.errors.get('password')\" :showRules=\"true\" autocomplete=\"new-password\" label=\"auth.forms.password\" />\n                <FormButtons :isBusy=\"registerForm.isBusy\" :isDisabled=\"registerForm.isDisabled\" caption=\"auth.register\" submitId=\"btnRegister\" />\n            </form>\n            <div class=\"nav-links\">\n                <p>{{ $t('auth.forms.already_register') }}&nbsp;<RouterLink id=\"lnkSignIn\" :to=\"{ name: 'login' }\" class=\"is-link\">{{ $t('auth.sign_in') }}</RouterLink></p>\n            </div>\n        </FormWrapper>\n        <!-- footer -->\n        <VueFooter />\n    </div>\n</template>\n"],"names":["user","useUserStore","notify","useNotifyStore","router","useRouter","showWebauthnRegistration","ref","deviceId","registerForm","reactive","Form","renameDeviceForm","register","e","response","registerWebauthnDevice","webauthnService","publicKeyCredential","error","RenameDevice","trans","onBeforeRouteLeave"],"mappings":"giBAMI,MAAMA,EAAOC,EAAY,EACnBC,EAASC,EAAc,EACvBC,EAASC,EAAS,EAClBC,EAA2BC,EAAI,EAAK,EACpCC,EAAWD,EAAI,IAAI,EAEnBE,EAAeC,EAAS,IAAIC,EAAK,CACnC,KAAO,GACP,MAAQ,GACR,SAAW,GACX,sBAAwB,EAChC,CAAK,CAAC,EAEIC,EAAmBF,EAAS,IAAIC,EAAK,CACvC,KAAO,EACf,CAAK,CAAC,EAKF,eAAeE,EAASC,EAAG,CACvBL,EAAa,sBAAwBA,EAAa,SAElDA,EAAa,KAAK,OAAO,EAAE,KAAKM,GAAY,CACxCf,EAAK,OAAO,CACR,KAAMe,EAAS,KAAK,KACpB,MAAOA,EAAS,KAAK,MACrB,YAAaA,EAAS,KAAK,YAC3B,QAASA,EAAS,KAAK,UAAY,EAEtC,CAAA,EACDf,EAAK,WAAU,EAEfM,EAAyB,MAAQ,EACpC,CAAA,CACJ,CAKD,SAASU,GAAyB,CAC9BC,EAAgB,SAAQ,EAAG,KAAMF,GAAa,CAC1C,MAAMG,EAAsB,KAAK,MAAMH,EAAS,OAAO,IAAI,EAE3DP,EAAS,MAAQU,EAAoB,EACxC,CAAA,EACA,MAAMC,GAAS,CACRA,EAAM,SAAS,SAAW,IAC1BjB,EAAO,MAAM,CAAE,KAAMiB,EAAM,SAAS,KAAK,OAAS,CAAA,EAGlDjB,EAAO,MAAMiB,CAAK,CAEzB,CAAA,CACT,CAKI,SAASC,EAAaN,EAAG,CACrBF,EAAiB,MAAM,yBAA2BJ,EAAS,MAAQ,OAAO,EACzE,KAAK,IAAM,CACRN,EAAO,QAAQ,CAAE,KAAMmB,EAAM,8CAA8C,CAAG,CAAA,EAC9EjB,EAAO,KAAK,CAAE,KAAM,UAAY,CAAA,CACnC,CAAA,CACT,CAEI,OAAAkB,EAAmB,IAAM,CACrBpB,EAAO,MAAK,CACf,CAAA"}